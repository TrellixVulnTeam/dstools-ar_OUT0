# snakefile for UCF101


import os
from os.path import join

from common.utils import load_config


load_config()
DATASETS_DIR = os.getenv('DATASETS_DIR')
DS_DIR = join(DATASETS_DIR, 'ucf101')
VIDEOS_DIR = join(DS_DIR, 'videos')
FRAMES_DIR = join(DS_DIR, 'frames')
REPS_2048_PATH = join(DS_DIR, 'ucf101_resnet50_2048.h5')
REPS_1024_PATH = join(DS_DIR, 'ucf101_resnet50_1024.h5')
REPS_0512_PATH = join(DS_DIR, 'ucf101_resnet50_0512.h5')


rule all:
  input:
    [REPS_1024_PATH, REPS_0512_PATH]

rule download:
  output:
    directory(VIDEOS_DIR)
  shell:
    "python preprocess.py download"

rule extract_frames:
  input:
    VIDEOS_DIR
  output:
    directory(FRAMES_DIR)
  shell:
    "python preprocess.py extract_frames"

rule extract_reps:
  input:
    FRAMES_DIR
  output:
    REPS_2048_PATH
  shell:
    "python preprocess.py extract_reps"

rule reduce_reps:
  input:
    REPS_2048_PATH
  output:
    [REPS_1024_PATH, REPS_0512_PATH]
  shell:
    """
    python preprocess.py reduce_reps 1024
    python preprocess.py reduce_reps 512
    """
